{% extends 'base.html' %}

{% block title %}
    Resumo de Prêmios - {{ tournament.nome }}
{% endblock %}

{% block breadcrumb-items %}
    <li class="breadcrumb-item"><a href="{% url 'tournament_dashboard' %}">Torneios</a></li>
    <li class="breadcrumb-item"><a href="{% url 'season_tournaments' tournament.season.id %}">{{ tournament.season.nome }}</a></li>
    <li class="breadcrumb-item active">Resumo de Prêmios</li>
{% endblock %}

{% block extra_css %}
<style>
    .summary-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 30px;
        border-radius: 8px;
        margin-bottom: 30px;
    }

    .summary-header h2 {
        margin-bottom: 10px;
    }

    .summary-card {
        background: white;
        border-radius: 8px;
        padding: 24px;
        margin-bottom: 24px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    }

    .payment-row {
        display: grid;
        grid-template-columns: 80px 2fr 1fr 1fr 80px;
        gap: 15px;
        padding: 15px;
        border-bottom: 1px solid #e9ecef;
        align-items: center;
    }

    .payment-row:last-child {
        border-bottom: none;
    }

    .payment-row.header {
        background: #f8f9fa;
        font-weight: bold;
        border-radius: 6px;
        margin-bottom: 10px;
    }

    .payment-position {
        font-size: 1.2rem;
        font-weight: bold;
        color: #667eea;
        text-align: center;
    }

    .payment-player {
        font-weight: 500;
    }

    .payment-amount {
        text-align: right;
        font-weight: bold;
    }

    .payment-percentage {
        text-align: right;
        color: #6c757d;
        font-size: 0.9rem;
    }

    .payment-status {
        text-align: center;
    }

    .badge-paid {
        background: #d4edda;
        color: #155724;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 0.8rem;
    }

    .badge-pending {
        background: #fff3cd;
        color: #856404;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 0.8rem;
    }

    .total-row {
        background: #f0f4ff;
        padding: 15px;
        border-radius: 6px;
        margin-top: 20px;
        font-weight: bold;
        font-size: 1.1rem;
        color: #667eea;
        display: flex;
        justify-content: space-between;
    }

    .btn-download {
        background: #667eea;
        color: white;
        padding: 10px 20px;
        border-radius: 6px;
        border: none;
        cursor: pointer;
        margin-top: 20px;
    }

    .tournament-info {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .info-box {
        background: white;
        padding: 15px;
        border-radius: 6px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    }

    .info-label {
        font-size: 0.85rem;
        color: #6c757d;
        margin-bottom: 5px;
        text-transform: uppercase;
        font-weight: bold;
    }

    .info-value {
        font-size: 1.2rem;
        font-weight: bold;
        color: #212529;
    }

    .print-button {
        background: white;
        border: 1px solid #dee2e6;
        padding: 8px 16px;
        border-radius: 6px;
        cursor: pointer;
        margin-left: 10px;
    }

    @media print {
        .no-print { display: none; }
        .summary-header { background: white; color: black; border: 2px solid #667eea; }
        .summary-card { box-shadow: none; border: 1px solid #dee2e6; }
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="summary-header">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <div>
                <h2><i class="bi bi-award"></i> Resumo de Prêmios</h2>
                <p class="mb-0">{{ tournament.nome }} • {{ tournament.season.nome }}</p>
            </div>
            <div class="no-print">
                <button class="print-button" onclick="window.print()">
                    <i class="bi bi-printer"></i> Imprimir
                </button>
            </div>
        </div>
    </div>

    <!-- INFORMAÇÕES DO TORNEIO -->
    <div class="tournament-info">
        <div class="info-box">
            <div class="info-label">Pote Total</div>
            <div class="info-value">R$ {{ prize_structure.total_prize_pool|floatformat:2 }}</div>
        </div>
        <div class="info-box">
            <div class="info-label">Premiados (ITM)</div>
            <div class="info-value">{{ prize_structure.itm_count }}</div>
        </div>
        <div class="info-box">
            <div class="info-label">Modo</div>
            <div class="info-value">{{ prize_structure.get_modo_display }}</div>
        </div>
        <div class="info-box">
            <div class="info-label">Data</div>
            <div class="info-value">{{ tournament.data|date:"d/m/Y" }}</div>
        </div>
    </div>

    <!-- TABELA DE PRÊMIOS -->
    <div class="summary-card">
        <h5><i class="bi bi-list-check"></i> Distribuição por Posição</h5>

        <div class="payment-row header">
            <div>Posição</div>
            <div>Jogador</div>
            <div>Percentual</div>
            <div>Prêmio</div>
            <div>Status</div>
        </div>

        {% for payment in payments %}
        <div class="payment-row">
            <div class="payment-position">
                {% if payment.position == 1 %}1º
                {% elif payment.position == 2 %}2º
                {% elif payment.position == 3 %}3º
                {% else %}{{ payment.position }}º{% endif %}
            </div>
            <div class="payment-player">
                {{ payment.player.nome|default:"---" }}
            </div>
            <div class="payment-percentage">
                {% if payment.percentage %}
                    {{ payment.percentage|floatformat:2 }}%
                {% else %}
                    ---
                {% endif %}
            </div>
            <div class="payment-amount">
                R$ {{ payment.amount|floatformat:2 }}
            </div>
            <div class="payment-status">
                {% if payment.pago %}
                    <span class="badge-paid">✓ Pago</span>
                {% else %}
                    <span class="badge-pending">◌ Pendente</span>
                {% endif %}
            </div>
        </div>
        {% endfor %}

        <!-- TOTAL -->
        <div class="total-row">
            <span>Total Distribuído</span>
            <span>R$ {{ total_distributed|floatformat:2 }}</span>
        </div>

        <!-- INFORMAÇÕES ADICIONAIS -->
        <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 6px;">
            <p class="mb-2"><strong>Informações:</strong></p>
            <ul class="mb-0">
                <li>{{ payments.count }} posições premiadas</li>
                <li>Pote total: R$ {{ prize_structure.total_prize_pool|floatformat:2 }}</li>
                <li>Distribuído: R$ {{ total_distributed|floatformat:2 }}</li>
                {% if total_distributed != prize_structure.total_prize_pool %}
                <li class="text-danger">
                    <strong>Diferença:</strong> R$ {{ prize_structure.total_prize_pool|add:total_distributed|floatformat:2|stringformat:"s"|slice:"1:" }}
                </li>
                {% endif %}
            </ul>
        </div>
    </div>

    <!-- BOTÕES DE AÇÃO -->
    <div class="no-print" style="display: flex; gap: 10px; margin-bottom: 30px;">
        <a href="{% url 'tournament_dashboard' %}" class="btn btn-secondary">
            <i class="bi bi-arrow-left"></i> Voltar
        </a>
        <button onclick="window.print()" class="btn btn-primary">
            <i class="bi bi-printer"></i> Imprimir
        </button>
    </div>
</div>
{% endblock %}
